<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solicitud Licencia</title>

<link rel="stylesheet" href="style.css">

</head>

<body>

<div class="container">

    <h2>SOLICITUD LICENCIA DE CONDUCIR</h2>

    <!-- FOTO -->
    <label class="label-title">* FOTO DEL SOLICITANTE</label>
    <button class="btn-primary" onclick="abrirModal()">Tomar foto</button>

    <img id="previewFinal" class="preview-img" style="display:none;">

    <hr>

    <!-- FORMULARIO -->
    <label>* NÃšMERO DE TELÃ‰FONO</label>
    <input id="telefono" type="text">

    <label>* TIPO DE LICENCIA</label>
    <select id="licencia">
        <option value="">Seleccionarâ€¦</option>
        <option value="Automovilista">Automovilista</option>
        <option value="Motociclista">Motociclista</option>
        <option value="Chofer">Chofer</option>
    </select>

    <label>* VALIDA POR</label>
    <select id="vigencia">
        <option value="">Seleccionarâ€¦</option>
        <option value="3 aÃ±os">3 aÃ±os</option>
        <option value="5 aÃ±os">5 aÃ±os</option>
    </select>

    <label>* NOMBRE COMPLETO</label>
    <input id="nombre" type="text">

    <label>* CURP</label>
    <input id="curp" type="text">

    <label>* CONTACTO DE EMERGENCIA</label>
    <input id="emergencia" type="text">

    <label>* DIRECCIÃ“N COMPLETA</label>
    <textarea id="direccion"></textarea>

    <button class="btn-primary" onclick="enviarWhatsApp()">Enviar WhatsApp</button>

</div>



<!-- ======================================================== -->
<!--                     MODAL CÃMARA                         -->
<!-- ======================================================== -->

<div id="modalCam" class="modal">

    <!-- Pantalla de captura -->
    <div id="screenCapture" class="camera-screen">

        <!-- BotÃ³n cerrar -->
        <span class="close-btn" onclick="cerrarModalCam()">Ã—</span>

        <!-- CÃ¡mara -->
        <video id="video" autoplay playsinline></video>

        <!-- Silueta -->
        <img src="silueta.png" class="silueta-overlay">

        <!-- BotÃ³n circular tipo cÃ¡mara -->
        <div class="shutter-btn" onclick="capturarFoto()"></div>
    </div>

    <!-- Pantalla de previsualizaciÃ³n -->
    <div id="screenPreview" class="preview-container">

        <img id="fotoPreview" class="preview-photo">

        <div class="camera-actions">
            <button class="action-btn btn-retry" onclick="repetirFoto()">Repetir</button>
            <button class="action-btn btn-confirm" onclick="confirmarFoto()">Usar foto</button>
        </div>

    </div>

</div>



<!-- ======================================================== -->
<!--                        LOADER                            -->
<!-- ======================================================== -->
<div id="loader" class="loader">
    <div class="spinner"></div>
    <p>Procesando...</p>
</div>


<!-- ======================================================== -->
<!--                     TOAST MESSAGE                        -->
<!-- ======================================================== -->
<div id="toast" class="toast"></div>



<!-- ======================================================== -->
<!--                        JAVASCRIPT                        -->
<!-- ======================================================== -->

<script>

let stream;
let imagenBase64 = "";

/* ========== ABRIR MODAL ========== */
function abrirModal() {
    document.getElementById("modalCam").style.display = "flex";
    document.getElementById("screenCapture").style.display = "flex";
    document.getElementById("screenPreview").style.display = "none";

    iniciarCamara();
}

/* ========== CERRAR MODAL ========== */
function cerrarModalCam() {
    document.getElementById("modalCam").style.display = "none";
    detenerCamara();
}

/* ========== INICIAR CÃMARA ========== */
function iniciarCamara() {
    navigator.mediaDevices.getUserMedia({ video: true })
    .then(s => {
        stream = s;
        document.getElementById("video").srcObject = s;
    })
    .catch(err => {
        toast("No se pudo acceder a la cÃ¡mara");
        console.error(err);
    });
}

/* ========== DETENER CÃMARA ========== */
function detenerCamara() {
    if (stream) stream.getTracks().forEach(t => t.stop());
}

/* ========== CAPTURAR FOTO ========== */
function capturarFoto() {
    const video = document.getElementById("video");

    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    const ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0);

    imagenBase64 = canvas.toDataURL("image/jpeg", 0.9);

    document.getElementById("fotoPreview").src = imagenBase64;

    document.getElementById("screenCapture").style.display = "none";
    document.getElementById("screenPreview").style.display = "block";
}

/* ========== REPETIR FOTO ========== */
function repetirFoto() {
    document.getElementById("screenCapture").style.display = "flex";
    document.getElementById("screenPreview").style.display = "none";
}

/* ========== CONFIRMAR FOTO ========== */
function confirmarFoto() {
    cerrarModalCam();

    document.getElementById("previewFinal").src = imagenBase64;
    document.getElementById("previewFinal").style.display = "block";

    toast("Foto guardada correctamente");
}

/* ========== ENVIAR WHATSAPP ========== */
function enviarWhatsApp(){

    if(!imagenBase64){
        toast("Primero toma la foto");
        return;
    }

    const msg = `
*SOLICITUD LICENCIA DE CONDUCIR*

ðŸ“¸ Foto lista

ðŸ“± TelÃ©fono: ${telefono.value}
ðŸªª Tipo licencia: ${licencia.value}
â³ Vigencia: ${vigencia.value}
ðŸ‘¤ Nombre: ${nombre.value}
ðŸ”¤ CURP: ${curp.value}
âš ï¸ Emergencia: ${emergencia.value}
ðŸ  DirecciÃ³n:
${direccion.value}
`;

    window.location.href = "https://wa.me/527225600905?text=" + encodeURIComponent(msg);
}

/* ========== TOAST ========== */
function toast(msg){
    const t = document.getElementById("toast");
    t.innerText = msg;
    t.style.display = "block";
    setTimeout(()=> t.style.display="none",2500);
}

</script>

</body>
</html>
